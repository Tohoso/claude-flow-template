# iPhone ショートカット設定ガイド

アクションボタンでレシートを撮影し、自動的に Google Drive に保存するショートカットを設定します。

## 前提条件

- iPhone 15 Pro / Pro Max 以降（アクションボタン搭載機種）
- Google Drive アプリがインストール済み
- Google アカウントでログイン済み

## ショートカット作成手順

### 1. ショートカットアプリを開く

1. 「ショートカット」アプリを起動
2. 右上の「+」をタップして新規作成

### 2. アクションを追加

以下の順序でアクションを追加します：

#### ステップ 1: カメラで写真を撮影

1. 「アクションを追加」をタップ
2. 「カメラ」で検索
3. 「写真を撮る」を選択
4. 設定：
   - カメラ: 背面
   - 「写真を表示」: オフ（効率化のため）

#### ステップ 2: 現在の日時を取得

1. 「+」をタップしてアクションを追加
2. 「日付」で検索
3. 「現在の日付」を選択

#### ステップ 3: 日付をフォーマット

1. 「+」をタップしてアクションを追加
2. 「日付」で検索
3. 「日付をフォーマット」を選択
4. 設定：
   - 日付フォーマット: カスタム
   - フォーマット文字列: `yyyy-MM-dd_HH-mm-ss`

#### ステップ 4: ファイル名を作成

1. 「+」をタップしてアクションを追加
2. 「テキスト」で検索
3. 「テキスト」を選択
4. 入力: `フォーマット済みの日付.jpg`
   - 「フォーマット済みの日付」は変数（青いタグ）として挿入

#### ステップ 5: Google Drive に保存

1. 「+」をタップしてアクションを追加
2. 「Google Drive」で検索
3. 「Google Drive にファイルをアップロード」を選択
4. 設定：
   - ファイル: 「写真」（ステップ1の出力）
   - 名前: 「テキスト」（ステップ4の出力）
   - パス: `/freee-receipts/pending/`
   - 上書き: オフ

### 3. ショートカットに名前を付ける

1. 上部の「新規ショートカット」をタップ
2. 名前を入力: 「レシート撮影」
3. アイコンを選択（カメラや領収書のアイコンがおすすめ）

### 4. アクションボタンに割り当て

1. 「設定」アプリを開く
2. 「アクションボタン」をタップ
3. 「ショートカット」を選択
4. 「レシート撮影」を選択

## 完成したショートカットのフロー

```
アクションボタン押下
    │
    ▼
カメラ起動 → 撮影
    │
    ▼
現在日時取得
    │
    ▼
ファイル名生成 (2026-01-09_14-30-00.jpg)
    │
    ▼
Google Drive にアップロード
(/freee-receipts/pending/2026-01-09_14-30-00.jpg)
    │
    ▼
完了
```

## Google Drive フォルダ構成

Google Drive に以下のフォルダ構成を作成してください：

```
マイドライブ/
└── freee-receipts/
    ├── pending/      ← ショートカットの保存先
    └── processed/    ← 処理済み（自動で移動される）
```

### フォルダ ID の取得方法

1. Google Drive でフォルダを開く
2. URL をコピー: `https://drive.google.com/drive/folders/XXXXX`
3. `XXXXX` の部分がフォルダ ID

これらの ID を `.env` ファイルに設定：

```
GOOGLE_PENDING_FOLDER_ID=XXXXX
GOOGLE_PROCESSED_FOLDER_ID=YYYYY
```

## トラブルシューティング

### 写真がアップロードされない

- Google Drive アプリにログインしているか確認
- ショートカットの権限を確認（設定 > ショートカット > 詳細）
- インターネット接続を確認

### アクションボタンが反応しない

- 設定 > アクションボタン で正しく設定されているか確認
- ショートカットが正しく保存されているか確認

### ファイル名が正しくない

- 日付フォーマットが `yyyy-MM-dd_HH-mm-ss` になっているか確認
- 変数が正しくリンクされているか確認

## 便利なカスタマイズ

### 撮影後に確認ダイアログを表示

撮影後に「保存しますか？」と確認したい場合：

1. 「メニューから選択」アクションを追加
2. 「保存」「キャンセル」の選択肢を作成
3. 条件分岐で「保存」が選択された場合のみアップロード

### 通知を表示

アップロード完了後に通知を受け取りたい場合：

1. 「通知を表示」アクションを最後に追加
2. 「レシートを保存しました」などのメッセージを設定
